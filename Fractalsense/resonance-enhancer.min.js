// Minified version of resonance-enhancer.js
class ResonanceEnhancer{constructor(){this.audioContext=null,this.oscillator=null,this.gainNode=null,this.isPlaying=!1,this.soundParams={type:"harmonic",baseFrequency:220,volume:.5,harmonics:[]},this.colorParams={mode:"resonant",speed:5,intensity:7},this.colorAnimationId=null,this.initializeUI(),this.initAudio()}initializeUI(){this.soundTypeSelect=document.getElementById("sound-type"),this.baseFrequencySlider=document.getElementById("base-frequency"),this.volumeSlider=document.getElementById("volume"),this.playButton=document.getElementById("play-sound"),this.soundWave=document.getElementById("sound-wave"),this.colorModeSelect=document.getElementById("color-mode"),this.colorSpeedSlider=document.getElementById("color-speed"),this.colorIntensitySlider=document.getElementById("color-intensity"),this.colorPreview=document.getElementById("color-preview"),this.setupEventListeners()}initAudio(){document.addEventListener("click",()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.setupAudioNodes())},{once:!0})}setupAudioNodes(){this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.soundParams.volume,this.gainNode.connect(this.audioContext.destination)}setupEventListeners(){this.soundTypeSelect.addEventListener("change",()=>{this.soundParams.type=this.soundTypeSelect.value,this.updateSound()}),this.baseFrequencySlider.addEventListener("input",()=>{this.soundParams.baseFrequency=parseFloat(this.baseFrequencySlider.value),this.updateSound()}),this.volumeSlider.addEventListener("input",()=>{this.soundParams.volume=parseFloat(this.volumeSlider.value)/100,this.gainNode&&(this.gainNode.gain.value=this.soundParams.volume)}),this.playButton.addEventListener("click",()=>{this.isPlaying?this.stopSound():this.playSound()}),this.colorModeSelect.addEventListener("change",()=>{this.colorParams.mode=this.colorModeSelect.value,this.updateColorPreview()}),this.colorSpeedSlider.addEventListener("input",()=>{this.colorParams.speed=parseInt(this.colorSpeedSlider.value)}),this.colorIntensitySlider.addEventListener("input",()=>{this.colorParams.intensity=parseInt(this.colorIntensitySlider.value),this.updateColorPreview()}),document.addEventListener("sensor-data-updated",e=>{this.onSensorDataUpdate(e.detail)}),document.addEventListener("fractal-updated",e=>{this.onFractalUpdate(e.detail)})}playSound(){if(!this.isPlaying&&this.audioContext){switch(this.oscillator=this.audioContext.createOscillator(),this.soundParams.type){case"harmonic":this.setupHarmonicSound();break;case"fractal":this.setupFractalSound();break;case"resonant":this.setupResonantSound();break;case"spectral":this.setupSpectralSound();break;default:this.oscillator.type="sine",this.oscillator.frequency.value=this.soundParams.baseFrequency}this.oscillator.connect(this.gainNode),this.oscillator.start(),this.isPlaying=!0,this.playButton.innerHTML='<div class="play-icon" style="border-width: 0 8px 0 8px;"></div> Stop',this.animateSoundWave()}}stopSound(){this.isPlaying&&this.oscillator&&(this.oscillator.stop(),this.oscillator.disconnect(),this.oscillator=null,this.isPlaying=!1,this.playButton.innerHTML='<div class="play-icon"></div> Klang abspielen',this.waveAnimationId&&(cancelAnimationFrame(this.waveAnimationId),this.waveAnimationId=null))}setupHarmonicSound(){this.oscillator.type="sine",this.oscillator.frequency.value=this.soundParams.baseFrequency;const e=1.61803398875,t=[];for(let s=1;s<=5;s++){const a=this.audioContext.createOscillator();a.type="sine";const o=this.soundParams.baseFrequency*Math.pow(e,s%3);a.frequency.value=o;const n=this.audioContext.createGain();n.gain.value=.15/(s*.8),a.connect(n),n.connect(this.gainNode),a.start(),t.push({oscillator:a,gain:n})}this.soundParams.harmonics=t}setupFractalSound(){this.oscillator.type="sawtooth",this.oscillator.frequency.value=this.soundParams.baseFrequency;const e=this.audioContext.createDelay();e.delayTime.value=.1+.2*Math.random();const t=this.audioContext.createGain();t.gain.value=.4,this.oscillator.connect(e),e.connect(t),t.connect(e),t.connect(this.gainNode);const s=this.audioContext.createOscillator();s.type="sine",s.frequency.value=this.soundParams.baseFrequency/4;const a=this.audioContext.createGain();a.gain.value=20,s.connect(a),a.connect(this.oscillator.frequency),s.start(),this.soundParams.harmonics=[{oscillator:s,gain:a},{delay:e,gain:t}]}setupResonantSound(){this.oscillator.type="sine",this.oscillator.frequency.value=this.soundParams.baseFrequency;const e=[],t=[1.5*this.soundParams.baseFrequency,2*this.soundParams.baseFrequency,2.5*this.soundParams.baseFrequency],s=this.createNoiseBuffer(),a=this.audioContext.createBufferSource();a.buffer=s,a.loop=!0;const o=this.audioContext.createGain();o.gain.value=.2,a.connect(o);for(let s=0;s<t.length;s++){const a=this.audioContext.createBiquadFilter();a.type="bandpass",a.frequency.value=t[s],a.Q.value=20,o.connect(a),a.connect(this.gainNode),e.push(a)}a.start(),this.soundParams.harmonics=[{source:a,gain:o,filters:e}]}setupSpectralSound(){this.oscillator.type="sine",this.oscillator.frequency.value=this.soundParams.baseFrequency;const e=[];for(let t=0;t<8;t++){const s=this.audioContext.createOscillator(),a=["sine","triangle","sawtooth","square"];s.type=a[t%a.length];const o=0===t?1:t*(1+.1*(t%3));s.frequency.value=this.soundParams.baseFrequency*o;const n=this.audioContext.createGain();n.gain.value=.15/(t+1),s.connect(n),n.connect(this.gainNode),s.start(),e.push({oscillator:s,gain:n})}this.soundParams.harmonics=e}createNoiseBuffer(){const e=2*this.audioContext.sampleRate,t=this.audioContext.createBuffer(1,e,this.audioContext.sampleRate),s=t.getChannelData(0);for(let t=0;t<e;t++)s[t]=2*Math.random()-1;return t}updateSound(){this.isPlaying&&(this.stopSound(),this.playSound())}updateColorPreview(){this.colorAnimationId&&cancelAnimationFrame(this.colorAnimationId);let e;switch(this.colorParams.mode){case"resonant":e=`linear-gradient(45deg, hsl(280, ${10*this.colorParams.intensity}%, 50%), hsl(180, ${10*this.colorParams.intensity}%, 60%), hsl(45, ${10*this.colorParams.intensity}%, 60%))`;break;case"harmonic":e=`linear-gradient(135deg, hsl(45, ${10*this.colorParams.intensity}%, 50%), hsl(135, ${10*this.colorParams.intensity}%, 60%), hsl(225, ${10*this.colorParams.intensity}%, 50%), hsl(315, ${10*this.colorParams.intensity}%, 60%))`;break;case"spectral":e=`linear-gradient(to right, hsl(0, ${10*this.colorParams.intensity}%, 50%), hsl(60, ${10*this.colorParams.intensity}%, 50%), hsl(120, ${10*this.colorParams.intensity}%, 50%), hsl(180, ${10*this.colorParams.intensity}%, 50%), hsl(240, ${10*this.colorParams.intensity}%, 50%), hsl(300, ${10*this.colorParams.intensity}%, 50%))`;break;case"fractal":e=`radial-gradient(circle at 30% 40%, hsl(280, ${10*this.colorParams.intensity}%, 30%), hsl(220, ${10*this.colorParams.intensity}%, 40%), hsl(180, ${10*this.colorParams.intensity}%, 20%))`;break;case"cosmic":return void this.animateCosmicTheme();default:e=`linear-gradient(45deg, hsl(280, ${10*this.colorParams.intensity}%, 50%), hsl(180, ${10*this.colorParams.intensity}%, 60%), hsl(45, ${10*this.colorParams.intensity}%, 60%))`}this.colorPreview.style.background=e}animateCosmicTheme(){this.colorPreview.style.background=`radial-gradient(ellipse at center, hsl(240, ${10*this.colorParams.intensity}%, 10%), hsl(260, ${10*this.colorParams.intensity}%, 5%))`;for(;this.colorPreview.firstChild;)this.colorPreview.removeChild(this.colorPreview.firstChild);const e=50+10*this.colorParams.intensity;for(let t=0;t<e;t++){const e=document.createElement("div");e.className="star";const s=100*Math.random(),a=100*Math.random(),o=1+3*Math.random(),n=2+8*Math.random();e.style.cssText=`\n                position: absolute;\n                left: ${s}%;\n                top: ${a}%;\n                width: ${o}px;\n                height: ${o}px;\n                background-color: white;\n                border-radius: 50%;\n                opacity: ${.5+.5*Math.random()};\n                animation: twinkle ${n}s infinite alternate;\n            `,this.colorPreview.appendChild(e)}const t=2+Math.floor(this.colorParams.intensity/3);for(let e=0;e<t;e++){const t=document.createElement("div");t.className="nebula";const s=20+60*Math.random(),a=20+60*Math.random(),o=30+40*Math.random(),n=180+180*Math.random();t.style.cssText=`\n                position: absolute;\n                left: ${s}%;\n                top: ${a}%;\n                width: ${o}px;\n                height: ${o}px;\n                background: radial-gradient(circle, \n                    hsla(${n}, 100%, 70%, 0.3), \n                    hsla(${n}, 100%, 50%, 0.1), \n                    transparent 70%);\n                border-radius: 50%;\n                filter: blur(5px);\n            `,this.colorPreview.appendChild(t)}document.getElementById("twinkle-animation")||(e=document.createElement("style"),e.id="twinkle-animation",e.textContent="\n                @keyframes twinkle {\n                    0% { opacity: 0.2; }\n                    100% { opacity: 1; }\n                }\n            ",document.head.appendChild(e));var e}animateSoundWave(){const e={harmonic:"M0,40 C30,20 10,60 40,40 C70,20 60,60 90,40 C120,20 110,60 140,40 C170,20 160,60 190,40 C220,20 210,60 240,40 C270,20 260,60 290,40",fractal:"M0,40 C10,10 20,70 30,40 C35,20 40,60 45,40 C50,30 55,50 60,40 C70,10 80,70 90,40 C100,20 110,60 120,40 C130,30 140,50 150,40",resonant:"M0,40 C30,40 30,10 60,10 C90,10 90,70 120,70 C150,70 150,10 180,10 C210,10 210,70 240,70 C270,70 270,40 300,40",spectral:"M0,40 C30,10 60,70 90,10 C120,70 150,10 180,70 C210,10 240,70 270,10 C300,70 330,10 360,40"},t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 300 80"),t.setAttribute("width","100%"),t.setAttribute("height","100%");const s=document.createElementNS("http://www.w3.org/2000/svg","path"),a=this.soundParams.type in e?this.soundParams.type:"harmonic";s.setAttribute("d",e[a]),s.setAttribute("fill","none"),s.setAttribute("stroke","#9d00ff"),s.setAttribute("stroke-width","2");const o=document.createElementNS("http://www.w3.org/2000/svg","animate");o.setAttribute("attributeName","d"),o.setAttribute("dur","2s"),o.setAttribute("repeatCount","indefinite");const n=e[a].split(" ").map(e=>{if(e.startsWith("M")||e.startsWith("C")){const t=e.substring(0,1),s=e.substring(1).split(","),a=s[0],o=parseInt(s[1])+20*Math.random()-10;return`${t}${a},${o}`}return e}).join(" ");o.setAttribute("values",`${e[a]};${n};${e[a]}`),s.appendChild(o),t.appendChild(s),this.soundWave.innerHTML="",this.soundWave.appendChild(t),this.waveAnimationId=requestAnimationFrame(()=>this.animateSoundWave())}onSensorDataUpdate(e){if(this.isPlaying){if(this.oscillator){const t=1+.1*e.accelY;this.oscillator.frequency.value=this.soundParams.baseFrequency*t}if(this.soundParams.harmonics.length>0)for(let t=0;t<this.soundParams.harmonics.length;t++){const s=this.soundParams.harmonics[t];if(s.oscillator){const a=1+.05*e.gyroX,o=s.oscillator.frequency.value;s.oscillator.frequency.value=o*a}s.gain&&(s.gain.gain.value=Math.max(.1,Math.min(1,.5+.1*e.gyroZ))*.2)}const t=20*e.accelX,s=5*e.gyroY;this.colorPreview.style.filter=`hue-rotate(${t}deg) saturate(${100+s}%)`}}onFractalUpdate(e){if(e.center){const t=e.center.x,s=e.center.y,a=1+.2*t;this.soundParams.baseFrequency=220*a,s>.5?this.soundParams.type="harmonic":s<-.5?this.soundParams.type="fractal":t>.5?this.soundParams.type="resonant":t<-.5&&(this.soundParams.type="spectral"),this.soundTypeSelect.value=this.soundParams.type,this.baseFrequencySlider.value=this.soundParams.baseFrequency,this.isPlaying&&this.updateSound()}if(e.zoom){const t=e.zoom;this.colorParams.mode=t>10?"cosmic":t>5?"fractal":t>2?"spectral":t>1?"harmonic":"resonant",this.colorParams.intensity=Math.min(10,Math.max(1,Math.floor(t))),this.colorModeSelect.value=this.colorParams.mode,this.colorIntensitySlider.value=this.colorParams.intensity,this.updateColorPreview()}}}window.ResonanceEnhancer=ResonanceEnhancer;
