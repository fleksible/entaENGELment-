// Minified version of fractal-visualizer.js
class FractalVisualizer{constructor(t){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.center={x:-.75,y:0},this.zoom=1,this.maxIterations=100,this.resolution=1,this.fractalType="mandelbrot",this.colorPalette=this.generateColorPalette(),this.resizeCanvas(),this.render(),window.addEventListener("resize",()=>this.resizeCanvas()),this.setupInteractivity()}resizeCanvas(){const t=this.canvas.parentElement;this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight,this.render()}generateColorPalette(){const t=[];for(let e=0;e<256;e++){const i=e/256,a=270-225*i,s=50+20*i;t.push(`hsl(${a}, 80%, ${s}%)`)}return t}render(){const t=this.canvas,{width:e,height:i}=t,a=this.ctx.createImageData(e,i),s=a.data,n=this.resolution,r=Math.floor(e*n),o=Math.floor(i*n),h=3/this.zoom,c=i/e*h,l=this.center.x-h/2,d=this.center.y-c/2,m=h/r,u=c/o;for(let t=0;t<o;t++)for(let i=0;i<r;i++){const a=l+i*m,r=d+t*u;let o;switch(this.fractalType){case"julia":o=this.calculateJulia(a,r);break;case"burning-ship":o=this.calculateBurningShip(a,r);break;default:o=this.calculateMandelbrot(a,r)}const h=this.getColor(o),c=Math.floor(i/n),f=Math.floor(t/n);if(c<e&&f<i){const t=4*(f*e+c);s[t]=h.r,s[t+1]=h.g,s[t+2]=h.b,s[t+3]=255}}this.ctx.putImageData(a,0,0)}calculateMandelbrot(t,e){let i=t,a=e,s=0,n=0;let r;for(r=0;r<this.maxIterations;r++){const t=s*s-n*n+i;if(n=2*s*n+a,s=t,s*s+n*n>4)break}if(r<this.maxIterations){const t=Math.log(s*s+n*n)/2,e=Math.log(t/Math.log(2))/Math.log(2);r=r+1-e}return r}calculateJulia(t,e){const i=-.7,a=.27;let s=t,n=e;let r;for(r=0;r<this.maxIterations;r++){const t=s*s-n*n+i;if(n=2*s*n+a,s=t,s*s+n*n>4)break}if(r<this.maxIterations){const t=Math.log(s*s+n*n)/2,e=Math.log(t/Math.log(2))/Math.log(2);r=r+1-e}return r}calculateBurningShip(t,e){let i=t,a=e,s=0,n=0;let r;for(r=0;r<this.maxIterations;r++){s=Math.abs(s),n=Math.abs(n);const t=s*s-n*n+i;if(n=2*s*n+a,s=t,s*s+n*n>4)break}if(r<this.maxIterations){const t=Math.log(s*s+n*n)/2,e=Math.log(t/Math.log(2))/Math.log(2);r=r+1-e}return r}getColor(t){if(t>=this.maxIterations)return{r:0,g:0,b:0};const e=t/this.maxIterations,i=Math.floor(e*(this.colorPalette.length-1)),a=this.colorPalette[i];return this.hslToRgb(a)}hslToRgb(t){const e=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!e)return{r:0,g:0,b:0};let i=parseInt(e[1])/360,a=parseInt(e[2])/100,s=parseInt(e[3])/100;let n,r,o;if(0===a)n=r=o=s;else{const t=(t,e,i)=>{return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},e=s<.5?s*(1+a):s+a-s*a,c=2*s-e;n=t(c,e,i+1/3),r=t(c,e,i),o=t(c,e,i-1/3)}return{r:Math.round(255*n),g:Math.round(255*r),b:Math.round(255*o)}}setupInteractivity(){let t=!1,e,i;this.canvas.addEventListener("mousedown",i=>{t=!0,e=i.offsetX,i=i.offsetY}),this.canvas.addEventListener("mousemove",a=>{if(!t)return;const s=a.offsetX-e,n=a.offsetY-i,r=3/this.zoom,o=this.canvas.height/this.canvas.width*r;this.center.x-=s*r/this.canvas.width,this.center.y-=n*o/this.canvas.height,e=a.offsetX,i=a.offsetY,this.render()}),this.canvas.addEventListener("mouseup",()=>{t=!1}),this.canvas.addEventListener("mouseleave",()=>{t=!1}),this.canvas.addEventListener("wheel",t=>{t.preventDefault();const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,a=t.clientY-e.top,s=3/this.zoom,n=this.canvas.height/this.canvas.width*s,r=this.center.x-s/2,o=this.center.y-n/2,h=r+i/this.canvas.width*s,c=o+a/this.canvas.height*n,l=t.deltaY<0?1.2:.8;this.zoom*=l;const d=3/this.zoom,m=this.canvas.height/this.canvas.width*d;this.center.x=h-(i/this.canvas.width-.5)*d,this.center.y=c-(a/this.canvas.height-.5)*m,this.render()});let a=0;this.canvas.addEventListener("touchstart",i=>{1===i.touches.length?(t=!0,e=i.touches[0].clientX,i=i.touches[0].clientY):2===i.touches.length&&(i=i.touches[0],i=i.touches[1],a=Math.hypot(i.clientX-i.clientX,i.clientY-i.clientY))}),this.canvas.addEventListener("touchmove",s=>{if(s.preventDefault(),1===s.touches.length&&t){const t=s.touches[0],i=t.clientX-e,a=t.clientY-i,n=3/this.zoom,r=this.canvas.height/this.canvas.width*n;this.center.x-=i*n/this.canvas.width,this.center.y-=a*r/this.canvas.height,e=t.clientX,i=t.clientY,this.render()}else if(2===s.touches.length){const t=s.touches[0],i=s.touches[1],n=Math.hypot(i.clientX-t.clientX,i.clientY-t.clientY);if(a>0){const s=(t.clientX+i.clientX)/2,r=(t.clientY+i.clientY)/2,o=this.canvas.getBoundingClientRect(),h=s-o.left,c=r-o.top,l=3/this.zoom,d=this.canvas.height/this.canvas.width*l,m=this.center.x-l/2,u=this.center.y-d/2,f=m+h/this.canvas.width*l,g=u+c/this.canvas.height*d,p=n/a;this.zoom*=p;const v=3/this.zoom,y=this.canvas.height/this.canvas.width*v;this.center.x=f-(h/this.canvas.width-.5)*v,this.center.y=g-(c/this.canvas.height-.5)*y,this.render()}a=n}}),this.canvas.addEventListener("touchend",()=>{t=!1,a=0})}updateParams(t){t.center&&(this.center=t.center),t.zoom&&(this.zoom=t.zoom),t.maxIterations&&(this.maxIterations=t.maxIterations),t.resolution&&(this.resolution=t.resolution),t.fractalType&&(this.fractalType=t.fractalType),this.render()}getParams(){return{center:this.center,zoom:this.zoom,maxIterations:this.maxIterations,resolution:this.resolution,fractalType:this.fractalType}}reset(){this.center={x:-.75,y:0},this.zoom=1,this.render()}}window.FractalVisualizer=FractalVisualizer;
