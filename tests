integration/test_integration.py
from tools.mzm_gate_toggle import Context, load_policy, gate_open

def test_gate_opens_with_valid_ctx():
    policy = load_policy()
    ctx = Context(phi=0.9, rcc_ec=True, non_overlap=True, m_norm_l2=1.0, psi_lock=True)
    assert gate_open(ctx, policy) is True

def test_gate_closes_on_phi_below_threshold():
    policy = load_policy()
    ctx = Context(phi=0.5, rcc_ec=True, non_overlap=True, m_norm_l2=1.0, psi_lock=True)
    assert gate_open(ctx, policy) is False
unit/test_core5_metrics.py
from src.core.metrics import eci, plv, mi, fd, pf

def test_metrics_exist_and_return_numbers():
    assert 0.0 <= eci([0.4, 0.6]) <= 1.0
    assert 0.0 <= plv([0.0, 0.1, 0.2]) <= 1.0
    assert isinstance(mi([1],[2]), float)
    assert isinstance(fd([1,2,3]), float)
    assert isinstance(pf([1,-1,1]), float)
ethics/T3_fail_safe_expired_consent.py
